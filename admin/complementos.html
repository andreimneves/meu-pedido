<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complementos - Meu Pedido</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-radius: 5px 5px 0 0;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: #f0f0f0;
            color: #C83232;
        }
        
        .tab-btn.active {
            background: #C83232;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .checkbox-group label {
            margin-bottom: 0;
        }
        
        .grupo-item {
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f9f9f9;
        }
        
        .grupo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .grupo-nome {
            font-weight: bold;
            font-size: 16px;
        }
        
        .badge {
            background: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        .badge.obrigatorio {
            background: #C83232;
        }
        
        .complemento-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px dashed #ddd;
        }
        
        .complemento-item:last-child {
            border-bottom: none;
        }
        
        .complemento-preco {
            color: #C83232;
            font-weight: bold;
        }
        
        .acoes-grupo {
            display: flex;
            gap: 5px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <h1>üçΩÔ∏è Meu Pedido - Painel Administrativo</h1>
        <div class="user-info">
            <span>üë§ DL Crepes e Lanches</span>
            <button class="logout" onclick="logout()">üö™ Sair</button>
        </div>
    </div>
    
    <div class="admin-container">
        <div class="admin-sidebar">
            <ul>
                <li><a href="dashboard.html">üìä Dashboard</a></li>
                <li><a href="produtos.html">üì¶ Produtos</a></li>
                <li><a href="categorias.html">üìÅ Categorias</a></li>
                <li><a href="pedidos.html">üìã Pedidos</a></li>
                <li><a href="config.html">‚öôÔ∏è Configura√ß√µes</a></li>
                <li><a href="complementos.html" class="active">üß© Complementos</a></li>
            </ul>
        </div>
        
        <div class="admin-content">
            <h1>üß© Gerenciar Complementos</h1>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="abrirTab('grupos')">üìÅ Grupos</button>
                <button class="tab-btn" onclick="abrirTab('complementos')">üß© Itens</button>
                <button class="tab-btn" onclick="abrirTab('vinculos')">üîó Vincular a Produtos</button>
            </div>
            
            <!-- TAB GRUPOS -->
            <div id="tab-grupos" class="tab-content active">
                <div class="card">
                    <h3>
                        <span>üìÅ Grupos de Complementos</span>
                        <button class="btn-add" onclick="abrirModalGrupo()" style="margin-left: auto; width: auto;">+ Novo Grupo</button>
                    </h3>
                    
                    <div id="gruposLista" class="grupos-container">
                        <div class="loading">Carregando grupos...</div>
                    </div>
                </div>
            </div>
            
            <!-- TAB COMPLEMENTOS -->
            <div id="tab-complementos" class="tab-content">
                <div class="card">
                    <h3>
                        <span>üß© Itens de Complemento</span>
                        <button class="btn-add" onclick="abrirModalComplemento()" style="margin-left: auto; width: auto;">+ Novo Item</button>
                    </h3>
                    
                    <div id="complementosLista">
                        <div class="loading">Carregando complementos...</div>
                    </div>
                </div>
            </div>
            
            <!-- TAB V√çNCULOS -->
            <div id="tab-vinculos" class="tab-content">
                <div class="card">
                    <h3>üîó Vincular Grupos a Produtos</h3>
                    
                    <div class="grid-2" style="margin-bottom: 20px;">
                        <div>
                            <label>Selecione o Produto</label>
                            <select id="produtoSelect" onchange="carregarVinculosProduto()">
                                <option value="">Carregando produtos...</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="vinculosContainer">
                        <p style="color:#999; text-align:center; padding:40px;">Selecione um produto para configurar os complementos</p>
                    </div>
                    
                    <button class="btn-save" onclick="salvarVinculos()" style="margin-top:20px;">üíæ Salvar V√≠nculos</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MODAL GRUPO -->
    <div id="grupoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModal('grupoModal')">&times;</span>
            <h2 id="grupoModalTitulo">Novo Grupo</h2>
            
            <form onsubmit="event.preventDefault(); salvarGrupo();">
                <div class="form-group">
                    <label>Nome do Grupo</label>
                    <input type="text" id="grupoNome" required>
                </div>
                
                <div class="form-group">
                    <label>Descri√ß√£o (opcional)</label>
                    <textarea id="grupoDescricao" rows="2"></textarea>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label>Limite de Sele√ß√£o</label>
                        <input type="number" id="grupoLimite" value="1" min="1" max="10">
                        <small>Quantos itens podem ser selecionados</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Ordem</label>
                        <input type="number" id="grupoOrdem" value="0">
                    </div>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="grupoObrigatorio">
                    <label for="grupoObrigatorio">Grupo obrigat√≥rio (cliente precisa selecionar)</label>
                </div>
                
                <button type="submit" class="btn-save">Salvar Grupo</button>
            </form>
        </div>
    </div>
    
    <!-- MODAL COMPLEMENTO -->
    <div id="complementoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModal('complementoModal')">&times;</span>
            <h2 id="complementoModalTitulo">Novo Item</h2>
            
            <form onsubmit="event.preventDefault(); salvarComplemento();">
                <div class="form-group">
                    <label>Nome do Item</label>
                    <input type="text" id="complementoNome" required>
                </div>
                
                <div class="form-group">
                    <label>Descri√ß√£o (opcional)</label>
                    <textarea id="complementoDescricao" rows="2"></textarea>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label>Pre√ßo (R$)</label>
                        <input type="number" id="complementoPreco" step="0.01" min="0" value="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="complementoCategoria">
                            <option value="massa">Massa</option>
                            <option value="borda">Borda</option>
                            <option value="sabor">Sabor</option>
                            <option value="acompanhamento">Acompanhamento</option>
                            <option value="bebida">Bebida</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label>Ordem</label>
                        <input type="number" id="complementoOrdem" value="0">
                    </div>
                    
                    <div class="checkbox-group" style="align-items: flex-end;">
                        <input type="checkbox" id="complementoDisponivel" checked>
                        <label for="complementoDisponivel">Dispon√≠vel</label>
                    </div>
                </div>
                
                <button type="submit" class="btn-save">Salvar Item</button>
            </form>
        </div>
    </div>
    
    <!-- MODAL VINCULAR ITEM AO GRUPO -->
    <div id="vincularItemModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharModal('vincularItemModal')">&times;</span>
            <h2>Vincular Item ao Grupo</h2>
            
            <div class="form-group">
                <label>Grupo</label>
                <input type="text" id="vincularGrupoNome" readonly disabled style="background:#f5f5f5;">
            </div>
            
            <div class="form-group">
                <label>Item</label>
                <select id="vincularItemSelect">
                    <option value="">Selecione um item...</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Ordem no grupo</label>
                <input type="number" id="vincularOrdem" value="0">
            </div>
            
            <button class="btn-save" onclick="salvarVinculoItem()">Vincular Item</button>
        </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        const API_URL = 'https://meu-pedido-backend.onrender.com/api';
        const SUBDOMINIO = 'dlcrepes';
        
        let grupos = [];
        let complementos = [];
        let produtos = [];
        let grupoSelecionado = null;
        let complementoEditando = null;
        let grupoEditando = null;

        // Verificar login
        if (!localStorage.getItem('adminLogado')) {
            window.location.href = 'index.html';
        }

        function logout() {
            localStorage.removeItem('adminLogado');
            window.location.href = 'index.html';
        }

        function abrirTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            if (tab === 'grupos') carregarGrupos();
            if (tab === 'complementos') carregarComplementos();
            if (tab === 'vinculos') {
                carregarProdutos();
                carregarGrupos();
            }
        }

        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ===== GRUPOS =====
        async function carregarGrupos() {
            try {
                const response = await fetch(`${API_URL}/grupos-complementos?tenant_id=1`);
                grupos = await response.json();
                exibirGrupos();
            } catch (error) {
                console.error('Erro ao carregar grupos:', error);
                document.getElementById('gruposLista').innerHTML = '<p style="color:red">Erro ao carregar grupos</p>';
            }
        }

        function exibirGrupos() {
            const container = document.getElementById('gruposLista');
            
            if (grupos.length === 0) {
                container.innerHTML = '<p style="text-align:center; padding:20px;">Nenhum grupo cadastrado</p>';
                return;
            }
            
            container.innerHTML = grupos.map(g => `
                <div class="grupo-item">
                    <div class="grupo-header">
                        <div>
                            <span class="grupo-nome">${g.nome}</span>
                            ${g.obrigatorio ? '<span class="badge obrigatorio">Obrigat√≥rio</span>' : ''}
                            <span class="badge">Limite: ${g.limite_selecao}</span>
                        </div>
                        <div class="acoes-grupo">
                            <button class="btn-edit btn-small" onclick="editarGrupo(${g.id})">Editar</button>
                            <button class="btn-delete btn-small" onclick="excluirGrupo(${g.id})">Excluir</button>
                        </div>
                    </div>
                    
                    ${g.descricao ? `<p style="color:#666; font-size:13px; margin-bottom:10px;">${g.descricao}</p>` : ''}
                    
                    <div style="margin-top:10px;">
                        <h4 style="font-size:14px; margin-bottom:5px;">Itens no grupo:</h4>
                        <div id="itens-grupo-${g.id}">
                            <p style="color:#999;">Carregando...</p>
                        </div>
                        <button class="btn-add btn-small" onclick="abrirVincularItem(${g.id}, '${g.nome}')" style="margin-top:10px;">
                            + Vincular Item
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Carregar itens de cada grupo
            grupos.forEach(g => carregarItensGrupo(g.id));
        }

        async function carregarItensGrupo(grupoId) {
            try {
                const response = await fetch(`${API_URL}/grupo-complementos/${grupoId}/itens`);
                const itens = await response.json();
                
                const container = document.getElementById(`itens-grupo-${grupoId}`);
                
                if (itens.length === 0) {
                    container.innerHTML = '<p style="color:#999; font-style:italic;">Nenhum item vinculado</p>';
                    return;
                }
                
                container.innerHTML = itens.map(item => `
                    <div class="complemento-item">
                        <span>${item.nome}</span>
                        <span class="complemento-preco">R$ ${parseFloat(item.preco).toFixed(2)}</span>
                        <button class="btn-delete btn-small" onclick="removerItemDoGrupo(${grupoId}, ${item.id})">√ó</button>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar itens do grupo:', error);
            }
        }

        function abrirModalGrupo() {
            grupoEditando = null;
            document.getElementById('grupoModalTitulo').textContent = 'Novo Grupo';
            document.getElementById('grupoNome').value = '';
            document.getElementById('grupoDescricao').value = '';
            document.getElementById('grupoLimite').value = '1';
            document.getElementById('grupoOrdem').value = '0';
            document.getElementById('grupoObrigatorio').checked = false;
            document.getElementById('grupoModal').style.display = 'block';
        }

        function editarGrupo(id) {
            const grupo = grupos.find(g => g.id === id);
            if (!grupo) return;
            
            grupoEditando = grupo;
            document.getElementById('grupoModalTitulo').textContent = 'Editar Grupo';
            document.getElementById('grupoNome').value = grupo.nome || '';
            document.getElementById('grupoDescricao').value = grupo.descricao || '';
            document.getElementById('grupoLimite').value = grupo.limite_selecao || 1;
            document.getElementById('grupoOrdem').value = grupo.ordem || 0;
            document.getElementById('grupoObrigatorio').checked = grupo.obrigatorio || false;
            document.getElementById('grupoModal').style.display = 'block';
        }

        async function salvarGrupo() {
            const nome = document.getElementById('grupoNome').value;
            const descricao = document.getElementById('grupoDescricao').value;
            const limite = parseInt(document.getElementById('grupoLimite').value);
            const ordem = parseInt(document.getElementById('grupoOrdem').value);
            const obrigatorio = document.getElementById('grupoObrigatorio').checked;
            
            if (!nome) {
                alert('Nome do grupo √© obrigat√≥rio');
                return;
            }
            
            const grupo = {
                tenant_id: 1,
                nome,
                descricao,
                limite_selecao: limite,
                ordem,
                obrigatorio
            };
            
            try {
                let response;
                if (grupoEditando) {
                    response = await fetch(`${API_URL}/grupos-complementos/${grupoEditando.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(grupo)
                    });
                } else {
                    response = await fetch(`${API_URL}/grupos-complementos`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(grupo)
                    });
                }
                
                if (response.ok) {
                    fecharModal('grupoModal');
                    await carregarGrupos();
                    mostrarNotificacao('Grupo salvo com sucesso!', 'sucesso');
                } else {
                    const erro = await response.json();
                    alert('Erro: ' + (erro.erro || 'Erro desconhecido'));
                }
            } catch (error) {
                alert('Erro de conex√£o: ' + error.message);
            }
        }

        async function excluirGrupo(id) {
            if (!confirm('Tem certeza que deseja excluir este grupo?')) return;
            
            try {
                const response = await fetch(`${API_URL}/grupos-complementos/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    await carregarGrupos();
                    mostrarNotificacao('Grupo exclu√≠do!', 'sucesso');
                } else {
                    alert('Erro ao excluir grupo');
                }
            } catch (error) {
                alert('Erro de conex√£o');
            }
        }

        // ===== COMPLEMENTOS =====
        async function carregarComplementos() {
            try {
                const response = await fetch(`${API_URL}/complementos?tenant_id=1`);
                complementos = await response.json();
                exibirComplementos();
            } catch (error) {
                console.error('Erro ao carregar complementos:', error);
                document.getElementById('complementosLista').innerHTML = '<p style="color:red">Erro ao carregar complementos</p>';
            }
        }

        function exibirComplementos() {
            const container = document.getElementById('complementosLista');
            
            if (complementos.length === 0) {
                container.innerHTML = '<p style="text-align:center; padding:20px;">Nenhum item cadastrado</p>';
                return;
            }
            
            container.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Categoria</th>
                            <th>Pre√ßo</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${complementos.map(c => `
                            <tr>
                                <td>${c.nome}</td>
                                <td>${c.categoria_complemento || '-'}</td>
                                <td>R$ ${parseFloat(c.preco).toFixed(2)}</td>
                                <td>${c.disponivel ? '‚úÖ' : '‚ùå'}</td>
                                <td>
                                    <button class="btn-edit" onclick="editarComplemento(${c.id})">Editar</button>
                                    <button class="btn-delete" onclick="excluirComplemento(${c.id})">Excluir</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function abrirModalComplemento() {
            complementoEditando = null;
            document.getElementById('complementoModalTitulo').textContent = 'Novo Item';
            document.getElementById('complementoNome').value = '';
            document.getElementById('complementoDescricao').value = '';
            document.getElementById('complementoPreco').value = '0.00';
            document.getElementById('complementoCategoria').value = 'acompanhamento';
            document.getElementById('complementoOrdem').value = '0';
            document.getElementById('complementoDisponivel').checked = true;
            document.getElementById('complementoModal').style.display = 'block';
        }

        function editarComplemento(id) {
            const comp = complementos.find(c => c.id === id);
            if (!comp) return;
            
            complementoEditando = comp;
            document.getElementById('complementoModalTitulo').textContent = 'Editar Item';
            document.getElementById('complementoNome').value = comp.nome || '';
            document.getElementById('complementoDescricao').value = comp.descricao || '';
            document.getElementById('complementoPreco').value = comp.preco || '0.00';
            document.getElementById('complementoCategoria').value = comp.categoria_complemento || 'acompanhamento';
            document.getElementById('complementoOrdem').value = comp.ordem || 0;
            document.getElementById('complementoDisponivel').checked = comp.disponivel !== false;
            document.getElementById('complementoModal').style.display = 'block';
        }

        async function salvarComplemento() {
            const nome = document.getElementById('complementoNome').value;
            const descricao = document.getElementById('complementoDescricao').value;
            const preco = parseFloat(document.getElementById('complementoPreco').value) || 0;
            const categoria = document.getElementById('complementoCategoria').value;
            const ordem = parseInt(document.getElementById('complementoOrdem').value) || 0;
            const disponivel = document.getElementById('complementoDisponivel').checked;
            
            if (!nome) {
                alert('Nome do item √© obrigat√≥rio');
                return;
            }
            
            const complemento = {
                tenant_id: 1,
                nome,
                descricao,
                preco,
                categoria_complemento: categoria,
                ordem,
                disponivel
            };
            
            try {
                let response;
                if (complementoEditando) {
                    response = await fetch(`${API_URL}/complementos/${complementoEditando.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(complemento)
                    });
                } else {
                    response = await fetch(`${API_URL}/complementos`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(complemento)
                    });
                }
                
                if (response.ok) {
                    fecharModal('complementoModal');
                    await carregarComplementos();
                    mostrarNotificacao('Item salvo com sucesso!', 'sucesso');
                } else {
                    const erro = await response.json();
                    alert('Erro: ' + (erro.erro || 'Erro desconhecido'));
                }
            } catch (error) {
                alert('Erro de conex√£o: ' + error.message);
            }
        }

        async function excluirComplemento(id) {
            if (!confirm('Tem certeza que deseja excluir este item?')) return;
            
            try {
                const response = await fetch(`${API_URL}/complementos/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    await carregarComplementos();
                    mostrarNotificacao('Item exclu√≠do!', 'sucesso');
                } else {
                    alert('Erro ao excluir item');
                }
            } catch (error) {
                alert('Erro de conex√£o');
            }
        }

        // ===== V√çNCULOS =====
        async function carregarProdutos() {
            try {
                const response = await fetch(`${API_URL}/produtos`);
                produtos = await response.json();
                
                const select = document.getElementById('produtoSelect');
                select.innerHTML = '<option value="">Selecione um produto...</option>' +
                    produtos.map(p => `<option value="${p.id}">${p.nome}</option>`).join('');
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
            }
        }

        async function carregarVinculosProduto() {
            const produtoId = document.getElementById('produtoSelect').value;
            
            if (!produtoId) {
                document.getElementById('vinculosContainer').innerHTML = '<p style="color:#999; text-align:center; padding:40px;">Selecione um produto</p>';
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/complementos/produto/${produtoId}`);
                const gruposVinculados = await response.json();
                
                let html = '<h3 style="margin-bottom:15px;">Grupos dispon√≠veis para este produto</h3>';
                
                grupos.forEach(grupo => {
                    const vinculado = gruposVinculados.find(g => g.id === grupo.id);
                    const selecionado = vinculado ? 'checked' : '';
                    
                    html += `
                        <div class="grupo-item" style="margin-bottom:10px;">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <div>
                                    <input type="checkbox" id="grupo_${grupo.id}" ${selecionado} onchange="toggleGrupoProduto(${grupo.id}, this.checked)">
                                    <label for="grupo_${grupo.id}" style="font-weight:bold;">${grupo.nome}</label>
                                    ${grupo.obrigatorio ? '<span class="badge obrigatorio">Obrigat√≥rio</span>' : ''}
                                </div>
                                <span class="badge">Limite: ${grupo.limite_selecao}</span>
                            </div>
                            ${grupo.descricao ? `<p style="color:#666; font-size:12px; margin-top:5px;">${grupo.descricao}</p>` : ''}
                        </div>
                    `;
                });
                
                document.getElementById('vinculosContainer').innerHTML = html;
                
            } catch (error) {
                console.error('Erro ao carregar v√≠nculos:', error);
                document.getElementById('vinculosContainer').innerHTML = '<p style="color:red">Erro ao carregar v√≠nculos</p>';
            }
        }

        function toggleGrupoProduto(grupoId, ativo) {
            // Armazenar temporariamente
            if (!window.gruposSelecionados) window.gruposSelecionados = {};
            window.gruposSelecionados[grupoId] = ativo;
        }

        async function salvarVinculos() {
            const produtoId = document.getElementById('produtoSelect').value;
            
            if (!produtoId) {
                alert('Selecione um produto');
                return;
            }
            
            // Coletar grupos selecionados
            const gruposSelecionados = [];
            document.querySelectorAll('#vinculosContainer input[type="checkbox"]:checked').forEach(cb => {
                const grupoId = parseInt(cb.id.replace('grupo_', ''));
                gruposSelecionados.push(grupoId);
            });
            
            try {
                const response = await fetch(`${API_URL}/produtos/${produtoId}/grupos`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ grupos: gruposSelecionados })
                });
                
                if (response.ok) {
                    mostrarNotificacao('V√≠nculos salvos com sucesso!', 'sucesso');
                } else {
                    alert('Erro ao salvar v√≠nculos');
                }
            } catch (error) {
                alert('Erro de conex√£o: ' + error.message);
            }
        }

        // ===== VINCULAR ITEM AO GRUPO =====
        function abrirVincularItem(grupoId, grupoNome) {
            grupoSelecionado = grupoId;
            document.getElementById('vincularGrupoNome').value = grupoNome;
            
            const select = document.getElementById('vincularItemSelect');
            select.innerHTML = '<option value="">Selecione...</option>' +
                complementos.map(c => `<option value="${c.id}">${c.nome} - R$ ${parseFloat(c.preco).toFixed(2)}</option>`).join('');
            
            document.getElementById('vincularOrdem').value = '0';
            document.getElementById('vincularItemModal').style.display = 'block';
        }

        async function salvarVinculoItem() {
            const complementoId = document.getElementById('vincularItemSelect').value;
            const ordem = parseInt(document.getElementById('vincularOrdem').value) || 0;
            
            if (!complementoId) {
                alert('Selecione um item');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/grupos/${grupoSelecionado}/itens/${complementoId}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ordem })
                });
                
                if (response.ok) {
                    fecharModal('vincularItemModal');
                    await carregarItensGrupo(grupoSelecionado);
                    mostrarNotificacao('Item vinculado com sucesso!', 'sucesso');
                } else {
                    const erro = await response.json();
                    alert('Erro: ' + (erro.erro || 'Erro desconhecido'));
                }
            } catch (error) {
                alert('Erro de conex√£o: ' + error.message);
            }
        }

        async function removerItemDoGrupo(grupoId, complementoId) {
            if (!confirm('Remover este item do grupo?')) return;
            
            try {
                const response = await fetch(`${API_URL}/grupos/${grupoId}/itens/${complementoId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    await carregarItensGrupo(grupoId);
                    mostrarNotificacao('Item removido do grupo!', 'sucesso');
                } else {
                    alert('Erro ao remover item');
                }
            } catch (error) {
                alert('Erro de conex√£o');
            }
        }

        // ===== NOTIFICA√á√ïES =====
        function mostrarNotificacao(mensagem, tipo = 'info') {
            // Implementar notifica√ß√£o popup
            alert(mensagem); // Tempor√°rio - substituir por popup depois
        }

        // Inicializar
        carregarGrupos();
        carregarComplementos();
    </script>
</body>
</html>