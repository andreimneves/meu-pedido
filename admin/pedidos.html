<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos - Meu Pedido</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .status-novo { background: #ff9800; color: white; padding: 3px 8px; border-radius: 12px; }
        .status-preparando { background: #2196F3; color: white; padding: 3px 8px; border-radius: 12px; }
        .status-pronto { background: #4CAF50; color: white; padding: 3px 8px; border-radius: 12px; }
        .status-entregue { background: #9C27B0; color: white; padding: 3px 8px; border-radius: 12px; }
        .status-cancelado { background: #f44336; color: white; padding: 3px 8px; border-radius: 12px; }
        
        .filtros {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filtro-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filtro-btn.active {
            background: #C83232;
            color: white;
            border-color: #C83232;
        }
        
        .filtro-btn:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <h1>Meu Pedido - Painel Administrativo</h1>
        <div class="user-info">
            <span>DL Crepes e Lanches</span>
            <button class="logout" onclick="logout()">Sair</button>
        </div>
    </div>
    
    <div class="admin-container">
        <div class="admin-sidebar">
            <ul>
                <li><a href="dashboard.html">üìä Dashboard</a></li>
                <li><a href="produtos.html">üì¶ Produtos</a></li>
                <li><a href="categorias.html">üìÅ Categorias</a></li>
                <li><a href="pedidos.html" class="active">üìã Pedidos</a></li>
                <li><a href="config.html">‚öôÔ∏è Configura√ß√µes</a></li>
            </ul>
        </div>
        
        <div class="admin-content">
            <h1>üìã Pedidos</h1>
            
            <div class="filtros">
                <button class="filtro-btn active" onclick="filtrarPedidos('todos')">Todos</button>
                <button class="filtro-btn" onclick="filtrarPedidos('novo')">üÜï Novos</button>
                <button class="filtro-btn" onclick="filtrarPedidos('preparando')">üë®‚Äçüç≥ Preparando</button>
                <button class="filtro-btn" onclick="filtrarPedidos('pronto')">‚úÖ Pronto</button>
                <button class="filtro-btn" onclick="filtrarPedidos('entregue')">üöö Entregue</button>
                <button class="filtro-btn" onclick="filtrarPedidos('cancelado')">‚ùå Cancelado</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Cliente</th>
                            <th>Telefone</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Data</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="pedidosTable">
                        <tr><td colspan="7">Carregando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        let todosPedidos = [];
        let filtroAtual = 'todos';
        
        async function carregarPedidos() {
            try {
                const response = await fetch(`${API_URL}/pedidos/${SUBDOMINIO}`);
                todosPedidos = await response.json();
                aplicarFiltro();
            } catch (error) {
                console.error('Erro ao carregar pedidos:', error);
                document.getElementById('pedidosTable').innerHTML = 
                    '<tr><td colspan="7" style="color:red">Erro ao carregar pedidos</td></tr>';
            }
        }
        
        function filtrarPedidos(filtro) {
            filtroAtual = filtro;
            
            document.querySelectorAll('.filtro-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            aplicarFiltro();
        }
        
        function aplicarFiltro() {
            let pedidosFiltrados = todosPedidos;
            if (filtroAtual !== 'todos') {
                pedidosFiltrados = todosPedidos.filter(p => p.status === filtroAtual);
            }
            exibirPedidos(pedidosFiltrados);
        }
        
        function exibirPedidos(pedidos) {
            const tbody = document.getElementById('pedidosTable');
            
            if (pedidos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7">Nenhum pedido encontrado</td></tr>';
                return;
            }
            
            tbody.innerHTML = pedidos.map(p => `
                <tr>
                    <td>#${p.id}</td>
                    <td>${p.cliente_nome}</td>
                    <td>${p.cliente_telefone}</td>
                    <td>R$ ${parseFloat(p.total).toFixed(2)}</td>
                    <td><span class="status-${p.status}">${p.status}</span></td>
                    <td>${new Date(p.data_pedido).toLocaleString('pt-BR')}</td>
                    <td>
                        <select onchange="atualizarStatus(${p.id}, this.value)" style="padding:5px; border-radius:5px;">
                            <option value="novo" ${p.status === 'novo' ? 'selected' : ''}>Novo</option>
                            <option value="preparando" ${p.status === 'preparando' ? 'selected' : ''}>Preparando</option>
                            <option value="pronto" ${p.status === 'pronto' ? 'selected' : ''}>Pronto</option>
                            <option value="entregue" ${p.status === 'entregue' ? 'selected' : ''}>Entregue</option>
                            <option value="cancelado" ${p.status === 'cancelado' ? 'selected' : ''}>Cancelado</option>
                        </select>
                    </td>
                </tr>
            `).join('');
        }
        
        async function atualizarStatus(pedidoId, novoStatus) {
            try {
                const response = await fetch(`${API_URL}/pedidos/${SUBDOMINIO}/${pedidoId}/status`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: novoStatus })
                });
                
                if (response.ok) {
                    await carregarPedidos();
                    alert('‚úÖ Status atualizado!');
                } else {
                    alert('Erro ao atualizar status');
                }
            } catch (error) {
                alert('Erro de conex√£o');
            }
        }
        
        carregarPedidos();
        setInterval(carregarPedidos, 30000); // Atualizar a cada 30s
    </script>
</body>
</html>